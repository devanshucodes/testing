import{jsx as o,Fragment as e,jsxs as n}from"react/jsx-runtime";import{useState as t,useEffect as r,useMemo as s}from"react";import{PrimaryButton as i}from"../../components/Button.mjs";import{FlexContainer as a}from"../../components/Layouts.mjs";import{BlobbyFooter as m}from"../../components/ModalFooter.mjs";import{QrCode as c}from"../../components/QrCode.mjs";import p from"../../components/embedded-wallets/FundWalletMethodHeader.mjs";import{InfoBanner as l}from"../../components/ui/banners/InfoBanner.mjs";import{Subtitle as d}from"../../components/ui/typography/Subtitle.mjs";import{Title as u}from"../../components/ui/typography/Title.mjs";import{WalletInfoCard as h}from"../../components/ui/wallet/WalletInfoCard.mjs";import{useAppConfig as j}from"../../configuration/context.mjs";import{usePrivyInternal as f}from"../../hooks/internal-context.mjs";import{usePrivyModal as g}from"../../hooks/modal-context.mjs";import{useWalletBalance as y}from"../../hooks/useWalletBalance.mjs";import{useWallets as v}from"../../hooks/useWallets.mjs";import{ON_RAMP_COMPLETE_ANALYTICS_EVENT as b}from"../../lib/funding/analytics.mjs";import{getNativeCurrencyFromLamports as C}from"../../lib/solana/transaction.mjs";import{getErc20Balance as I}from"../../lib/wallets/actions/getErc20Balance.mjs";import{usePlugins as S}from"../../plugins/context/PrivyPluginContext.mjs";import{SOLANA_FUNDING_PLUGIN_ID as k}from"../../plugins/solana-funding/id.mjs";import{Blobby as w}from"../../svg/blobby.mjs";import{formatWalletAddress as T}from"../../utils/index.mjs";import{ModalScreen as E}from"../index.mjs";import{useSolanaWallets as x}from"../../hooks/useSolanaWallets.mjs";import{a as A,e as M}from"../../formatters--YjgN2Dw.mjs";import"styled-components";import"../../components/Loader.mjs";import"../../svg/protected-by-privy.mjs";import"qrcode";import"../../svg/black-rounded-square.mjs";import"../../config.mjs";import"../../configuration/defaultClientConfig.mjs";import"../../constants.mjs";import"../../configuration/login-methods.mjs";import"../../configuration/wallets.mjs";import"../../connectors/chains/index.mjs";import"../../connectors/chains/arbitrum.mjs";import"../../connectors/chains/arbitrumSepolia.mjs";import"../../connectors/chains/avalanche.mjs";import"../../connectors/chains/avalancheFuji.mjs";import"../../connectors/chains/base.mjs";import"../../connectors/chains/baseSepolia.mjs";import"../../connectors/chains/berachainArtio.mjs";import"../../connectors/chains/celo.mjs";import"../../connectors/chains/celoAlfajores.mjs";import"../../connectors/chains/filecoin.mjs";import"../../connectors/chains/filecoinCalibration.mjs";import"../../connectors/chains/garnetHolesky.mjs";import"../../connectors/chains/holesky.mjs";import"../../connectors/chains/linea.mjs";import"../../connectors/chains/lineaTestnet.mjs";import"../../connectors/chains/lukso.mjs";import"../../connectors/chains/mainnet.mjs";import"../../connectors/chains/optimism.mjs";import"../../connectors/chains/optimismSepolia.mjs";import"../../connectors/chains/polygon.mjs";import"../../connectors/chains/polygonAmoy.mjs";import"../../connectors/chains/redstone.mjs";import"../../connectors/chains/sepolia.mjs";import"../../connectors/chains/zora.mjs";import"../../connectors/chains/zoraSepolia.mjs";import"../../connectors/chains/zoraTestnet.mjs";import"../../connectors/chains/utils.mjs";import"../../lib/solana/index.mjs";import"../../theme.mjs";import"tinycolor2";import"../../lib/cybr53.mjs";import"@ethersproject/providers";import"../../connectors/get-legacy-injected-providers.mjs";import"../../connectors/is-wallet-installed.mjs";import"../../errors.mjs";import"ofetch";import"../../components/ModalHeader.mjs";import"@heroicons/react/24/outline/ArrowLeftIcon";import"@heroicons/react/24/outline/ArrowRightIcon";import"@heroicons/react/24/outline/QuestionMarkCircleIcon";import"@heroicons/react/24/outline/XMarkIcon";import"../../hooks/index.mjs";import"@heroicons/react/24/outline/InformationCircleIcon";import"../../components/ui/chips/Chip.mjs";import"../../components/ui/animation/LoadingSkeleton.mjs";import"../../components/ui/layout/Column.mjs";import"../../components/ui/typography/ErrorMessage.mjs";import"../../components/ui/typography/LabelXs.mjs";import"../../components/ui/wallet/Address.mjs";import"@heroicons/react/24/outline/CheckIcon";import"@heroicons/react/24/outline/Square2StackIcon";import"../../components/ui/wallet/shared.mjs";import"../../components/PrefetchedImage.mjs";import"viem";import"../../utils/buffer/readBigInt64LE.mjs";import"../../client/user.mjs";import"@ethersproject/address";import"../../hooks/privy-context.mjs";const L=()=>{let{wallets:w}=v(),{wallets:L}=x(),{data:R,setModalData:D,navigate:F,lastScreen:O}=g(),{rpcConfig:P,appId:W,createAnalyticsEvent:q,closePrivyModal:z}=f(),H=j(),[_,U]=t(void 0),[Q,X]=t(!1),$=S(),G=R?.funding,{reloadBalance:Y}=y({rpcConfig:P,appId:W,address:"ethereum"===G.chainType?G.address:void 0,chain:"ethereum"===G.chainType?G.chain:void 0}),J="solana"===G.chainType,K=J?"SOL":G.erc20Address?G.erc20ContractInfo?.symbol:G.chain.nativeCurrency.symbol,V=J?L.find((({address:o})=>o===G.address)):w.find((({address:o})=>T(o)===T(G.address)));if(!G)return D({errorModalData:{error:Error("Couldn't find funding config"),previousScreen:O||E.FUNDING_METHOD_SELECTION_SCREEN},funding:R?.funding,sendTransaction:R?.sendTransaction}),F(E.ERROR_SCREEN),/*#__PURE__*/o(e,{});r((()=>{let o=J?async function(){if("solana"!==G.chainType)return;let o=$(k);o?o.getBalance({address:G.address,cluster:G.cluster}).then((o=>{let e=BigInt(o);_&&e>_&&(X(!0),q({eventName:b,payload:{provider:"manual",status:"success",chainType:"solana",address:V?.address,value:(e-_).toString()}})),U(e)})):console.warn("Unable to load solana plugin, skipping balance")}:async function(){"ethereum"===G.chainType&&(async()=>{if(!G.erc20Address)return await Y()??BigInt(0);{let{balance:o}=await I({chain:G.chain,address:G.address,erc20Address:G.erc20Address,rpcConfig:P,appId:W});return o}})().then((o=>{_&&o>_&&(X(!0),q({eventName:b,payload:{provider:"manual",status:"success",chainType:"ethereum",address:V?.address,value:(o-_).toString()}})),U(o)})).catch((()=>U(void 0)))},e=setInterval(o,2e3);return o(),()=>clearInterval(e)}),[_]);let Z=s((()=>void 0!==_&&_>=parseFloat(G.amount)),[_,G.amount]),oo=s((()=>null==_?"":G.isUSDC?A({amount:_,decimals:6}):J?C(_,3,!0,!0):null!=G.erc20ContractInfo?.decimals?A({amount:_,decimals:G.erc20ContractInfo.decimals}):M({wei:_})),[_,J,G]),eo="ethereum"===G.chainType?G.chain.name:N[G.cluster.name];/*#__PURE__*/return n(e,{children:[/*#__PURE__*/o(p,{}),/*#__PURE__*/n(u,{children:["Receive ",G.amount," ",K]}),/*#__PURE__*/n(d,{children:["Scan this code or copy your wallet address to receive funds on ",eo,"."]}),/*#__PURE__*/n(a,{style:{gap:"1rem",margin:"1rem 0"},children:[/*#__PURE__*/o(c,{url:G.address,size:200,squareLogoElement:B}),/*#__PURE__*/n(l,{theme:H.appearance.palette.colorScheme,children:["Make sure to send funds on ",eo,"."]}),/*#__PURE__*/o(h,{title:"Your wallet",errMsg:void 0,showIcon:!0,isLoading:!G||void 0===_,isPulsing:!Z,balance:`${oo} ${K}`,address:G.address,statusColor:Z?"green":"gray"}),Q&&/*#__PURE__*/o(i,{onClick:()=>z({shouldCallAuthOnSuccess:!1,isSuccess:!0}),children:"Continue"})]}),/*#__PURE__*/o(m,{})]})};let B=({...e})=>/*#__PURE__*/o(w,{color:"black",...e}),N={devnet:"Devnet","mainnet-beta":"Solana",testnet:"Testnet"};export{L as ManualTransferScreen};
