import{jsxs as o,Fragment as t,jsx as e}from"react/jsx-runtime";import{isHexString as n}from"@ethersproject/bytes";import{toUtf8String as r}from"@ethersproject/strings";import{useState as i,useEffect as s}from"react";import{styled as c}from"styled-components";import{PrimaryButtonWithoutGray as m}from"../components/Button.mjs";import{CopytoClipboardButton as a}from"../components/CopyToClipboard.mjs";import{RefactorSpacerTop as p,RefactorSpacerBottom as l}from"../components/Layouts.mjs";import{BlobbyFooter as h}from"../components/ModalFooter.mjs";import{ModalHeader as d}from"../components/ModalHeader.mjs";import{StyledLogo as g}from"../components/embedded-wallets/StyledLogo.mjs";import{Subtitle as f}from"../components/ui/typography/Subtitle.mjs";import{Title as j}from"../components/ui/typography/Title.mjs";import{PrivyProviderRpcError as u,ProviderRpcError as y}from"../connectors/errors.mjs";import{WALLET_PROXY_TIMEOUT as w,DEFAULT_SUCCESS_SCREEN_DURATION_MS as x}from"../constants.mjs";import{usePrivyInternal as b}from"../hooks/internal-context.mjs";import{usePrivyModal as v}from"../hooks/modal-context.mjs";import{usePrivyContext as C}from"../hooks/privy-context.mjs";import{Checkmark as S}from"../svg/checkmark.mjs";import{ModalScreen as T}from"./index.mjs";import{n as I}from"../errors-9ucGZPEs.mjs";import"../components/Loader.mjs";import"../svg/copy.mjs";import"../svg/protected-by-privy.mjs";import"@heroicons/react/24/outline/ArrowLeftIcon";import"@heroicons/react/24/outline/ArrowRightIcon";import"@heroicons/react/24/outline/QuestionMarkCircleIcon";import"@heroicons/react/24/outline/XMarkIcon";import"../configuration/context.mjs";import"../config.mjs";import"../configuration/defaultClientConfig.mjs";import"../configuration/login-methods.mjs";import"../configuration/wallets.mjs";import"../connectors/chains/index.mjs";import"../connectors/chains/arbitrum.mjs";import"../connectors/chains/arbitrumSepolia.mjs";import"../connectors/chains/avalanche.mjs";import"../connectors/chains/avalancheFuji.mjs";import"../connectors/chains/base.mjs";import"../connectors/chains/baseSepolia.mjs";import"../connectors/chains/berachainArtio.mjs";import"../connectors/chains/celo.mjs";import"../connectors/chains/celoAlfajores.mjs";import"../connectors/chains/filecoin.mjs";import"../connectors/chains/filecoinCalibration.mjs";import"../connectors/chains/garnetHolesky.mjs";import"../connectors/chains/holesky.mjs";import"../connectors/chains/linea.mjs";import"../connectors/chains/lineaTestnet.mjs";import"../connectors/chains/lukso.mjs";import"../connectors/chains/mainnet.mjs";import"../connectors/chains/optimism.mjs";import"../connectors/chains/optimismSepolia.mjs";import"../connectors/chains/polygon.mjs";import"../connectors/chains/polygonAmoy.mjs";import"../connectors/chains/redstone.mjs";import"../connectors/chains/sepolia.mjs";import"../connectors/chains/zora.mjs";import"../connectors/chains/zoraSepolia.mjs";import"../connectors/chains/zoraTestnet.mjs";import"../connectors/chains/utils.mjs";import"../lib/solana/index.mjs";import"../theme.mjs";import"tinycolor2";import"../lib/cybr53.mjs";import"../hooks/index.mjs";import"@ethersproject/logger";import"../errors.mjs";import"ofetch";import"../components/PrefetchedImage.mjs";let k=o=>{if(!n(o))return o;try{return r(o)}catch{return o}},E=({data:t})=>{let n=t=>"object"==typeof t&&null!==t?/*#__PURE__*/e(_,{children:Object.entries(t).map((([t,e])=>/*#__PURE__*/o("li",{children:[/*#__PURE__*/o("strong",{children:[t,":"]})," ",n(e)]},t)))}):/*#__PURE__*/e("span",{children:String(t)});/*#__PURE__*/return e("div",{children:n(t)})},A=n=>{let{types:r,primaryType:i,...s}=n.typedData;/*#__PURE__*/return o(t,{children:[/*#__PURE__*/e(R,{children:/*#__PURE__*/e(E,{data:s})}),/*#__PURE__*/e(a,{text:(c=n.typedData,JSON.stringify(c,null,2)),itemName:"full payload to clipboard"})," "]});var c};const N=()=>{let{authenticated:n}=C(),{initializeWalletProxy:r,closePrivyModal:c}=b(),{navigate:a,data:E,onUserCloseViaDialogOrKeybindRef:N}=v(),[_,O]=i(!0),[z,F]=i(""),[H,P]=i(),[W,G]=i(null),[J,Q]=i(!1),$=null!==W;s((()=>{n||a(T.LANDING)}),[n]),s((()=>{r(w).then((o=>{O(!1),o||(F("An error has occurred, please try again."),P(new u(new y(z,I.E32603_DEFAULT_INTERNAL_ERROR.eipCode))))}))}),[]);let{method:q,data:B,confirmAndSign:K,onSuccess:V,onFailure:X,uiOptions:Y}=E.signMessage,Z={title:Y.title||"Sign message",description:Y.description||"Signing this message will not cost you any fees.",buttonText:Y.buttonText||"Sign and continue"},oo=o=>{o?V(o):X(H||new u(new y("The user rejected the request.",I.E4001_USER_REJECTED_REQUEST.eipCode))),c({shouldCallAuthOnSuccess:!1}),setTimeout((()=>{G(null),F(""),P(void 0)}),200)};return N.current=()=>{oo(W)},/*#__PURE__*/o(t,{children:[/*#__PURE__*/e(d,{onClose:()=>oo(W)}),/*#__PURE__*/e(p,{}),Y.iconUrl&&"string"==typeof Y.iconUrl?/*#__PURE__*/e(M,{children:/*#__PURE__*/e(g,{size:"sm",src:Y.iconUrl,alt:"app image"})}):null,/*#__PURE__*/e(j,{children:Z.title}),/*#__PURE__*/e(f,{children:Z.description}),"personal_sign"===q&&/*#__PURE__*/e(R,{children:k(B)}),"eth_signTypedData_v4"===q&&/*#__PURE__*/e(A,{typedData:B}),"solana_signMessage"===q&&/*#__PURE__*/e(R,{children:B}),/*#__PURE__*/e(U,{}),/*#__PURE__*/e(L,{$fail:!0,children:z}),/*#__PURE__*/e(m,{disabled:J||$||_,loading:J,onClick:async()=>{Q(!0),F("");try{let o=await K();G(o),Q(!1),setTimeout((()=>{oo(o)}),x)}catch(o){console.error(o),F("An error has occurred, please try again."),P(new u(new y(z,I.E32603_DEFAULT_INTERNAL_ERROR.eipCode))),Q(!1)}},children:J?"Signing...":$?/*#__PURE__*/o(D,{children:[/*#__PURE__*/e(S,{style:{height:"0.9rem",width:"0.9rem"},strokeWidth:2})," ",/*#__PURE__*/e("span",{children:"Success"})]}):Z.buttonText}),/*#__PURE__*/e(l,{}),/*#__PURE__*/e(h,{})]})};let R=/*#__PURE__*/c.div.withConfig({displayName:"Message",componentId:"sc-8f49c712-0"})(["margin-top:1.5rem;background-color:var(--privy-color-background-2);border-radius:var(--privy-border-radius-md);padding:12px;text-align:left;max-height:310px;overflow:scroll;white-space:pre-wrap;width:100%;-ms-overflow-style:none;scrollbar-width:none;&::-webkit-scrollbar{display:none;}}"]),_=/*#__PURE__*/c.ul.withConfig({displayName:"MessageList",componentId:"sc-8f49c712-1"})(["margin-left:12px !important;white-space:nowrap;&:first-child{margin-left:0 !important;}strong{font-weight:500 !important;}}"]),L=/*#__PURE__*/c.div.withConfig({displayName:"InputHelp",componentId:"sc-8f49c712-2"})(["line-height:20px;height:20px;font-size:13px;color:",";display:flex;justify-content:flex-start;width:100%;margin-top:16px;margin-bottom:4px;"],(o=>o.$fail?"var(--privy-color-error)":"var(--privy-color-foreground-3)")),D=/*#__PURE__*/c.span.withConfig({displayName:"ContentWithIcon",componentId:"sc-8f49c712-3"})(["display:flex;align-items:center;gap:8px;"]),M=/*#__PURE__*/c.div.withConfig({displayName:"IconContainer",componentId:"sc-8f49c712-4"})(["display:flex;flex-direction:column;justify-content:center;align-items:center;width:100%;height:82px;"]),U=/*#__PURE__*/c.div.withConfig({displayName:"Grow",componentId:"sc-8f49c712-5"})(["flex-grow:1;"]);export{N as SignRequestScreen};
