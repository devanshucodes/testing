"use strict";var e=require("../../../screens/index.js"),a=require("../../popup/triggerPopup.js"),s=require("./toCoinbaseBlockchainFromChainId.js");require("../../../connectors/chains/arbitrum.js"),require("../../../connectors/chains/base.js"),require("../../../connectors/chains/mainnet.js"),require("../../../connectors/chains/optimism.js"),require("../../../connectors/chains/polygon.js"),require("../../../errors.js"),require("ofetch");let r={buy:"CARD",send:"CRYPTO_ACCOUNT"},n={USDC:"2b92315d-eab7-5bef-84fa-089a131333f5",ETH:"d85dce9b-5b73-5c3c-8978-522ce1d1c1b4",BTC:"5b71fc48-3dd3-540c-809b-f8c94d0e68b5",SOL:"4f039497-3af8-5bb3-951c-6df9afa9be1c",POL:"026bcc1e-9163-591c-a709-34dd18b2e7a1"};function t({input:e,amount:a,blockchain:s,asset:t,experience:i}){let c=new URL("https://pay.coinbase.com/buy/select-asset");return c.searchParams.set("appId",e.app_id),c.searchParams.set("sessionToken",e.session_token),c.searchParams.set("defaultExperience",i),c.searchParams.set("presetCryptoAmount",a.startsWith(".")?`0${a}`:a),c.searchParams.set("defaultNetwork",s),c.searchParams.set("defaultPaymentMethod",r[i]),c.searchParams.set("defaultAsset",n[t]),c.searchParams.set("partnerUserId",e.partner_user_id),{url:c}}exports.triggerCoinbaseFlow=(r,n,i,c,o,u)=>new Promise((async(d,p)=>{let h=a.triggerPopup();if(!h)return void p(Error("Unable to initialize flow"));let m="ethereum"===n.chainType?s.toCoinbaseBlockchainFromChainId(n.chain.id):"solana",b=n.isUSDC?"USDC":"ethereum"===n.chainType?"ETH":"SOL",l=await r.initCoinbaseOnRamp({addresses:[{address:n.address,blockchains:[m]}],assets:[b]}),{url:f}=t({input:l,amount:n.amount,blockchain:m,asset:b,experience:u});h.location=f.toString();let g={...o?.funding,showAlternateFundingMethod:!0};n.usingDefaultFundingMethod&&(g.usingDefaultFundingMethod=!1),i({funding:g,coinbaseOnrampStatus:{popup:h}}),c(e.ModalScreen.COINBASE_ONRAMP_STATUS_SCREEN),r.createAnalyticsEvent({eventName:"sdk_fiat_on_ramp_started",payload:{provider:"buy"===u?"coinbase-onramp":"coinbase-exchange",value:n.amount,chainType:n.chainType,chainId:"ethereum"===n.chainType?n.chain.id:n.cluster.name}}),setTimeout((()=>{i({funding:g,coinbaseOnrampStatus:{partnerUserId:l.partner_user_id,popup:h}})}),5e3),d()}));
