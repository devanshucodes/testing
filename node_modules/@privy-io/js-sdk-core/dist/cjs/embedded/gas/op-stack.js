"use strict";var e=require("@ethersproject/bignumber"),r=require("@ethersproject/contracts"),i=require("@ethersproject/transactions"),a=require("../../chains/base.js"),s=require("../../chains/baseGoerli.js"),t=require("../../chains/baseSepolia.js"),o=require("../../chains/optimism.js"),n=require("../../chains/optimismGoerli.js"),c=require("../../chains/optimismSepolia.js"),m=require("../../chains/zora.js"),u=require("../../chains/zoraSepolia.js"),P=require("../../chains/zoraTestnet.js"),h=require("../utils/ethers.js");const l=81457,d=168587773,p="0x420000000000000000000000000000000000000F",G=["function getL1Fee(bytes memory _data) external view returns (uint256)"],F=e=>[a.base.id,s.baseGoerli.id,t.baseSepolia.id,o.optimism.id,n.optimismGoerli.id,c.optimismSepolia.id,m.zora.id,P.zoraTestnet.id,u.zoraSepolia.id,l,d].includes(e);exports.OPTIMISM_STACK_GAS_PRICE_ORACLE_ABI=G,exports.OPTIMISM_STACK_GAS_PRICE_ORACLE_ADDRESS=p,exports.defaultGasForOpStack=async(r,i)=>{if(!F(r.chainId))throw new Error("Invalid chain ID for OP Stack gas estimation.");if(void 0===r.type&&(r.type=2),r.gasPrice&&(console.warn("`gasPrice` is not supported on this chain and will be ignored. Use `maxPriorityFeePerGas` and/or `maxFeePerGas` instead."),delete r.gasPrice),r.maxPriorityFeePerGas&&r.maxFeePerGas)return r;try{if(!r.maxPriorityFeePerGas){const e=await i.send("eth_maxPriorityFeePerGas",[]);r.maxPriorityFeePerGas=e}if(r.maxFeePerGas&&(console.warn("maxFeePerGas is specified without maxPriorityFeePerGas - this can result in hung transactions."),r.maxPriorityFeePerGas>=r.maxFeePerGas))throw new Error("Overridden maxFeePerGas is less than or equal to the calculated maxPriorityFeePerGas. Please set both values or maxPriorityFeePerGas alone for correct gas estimation.");if(!r.maxFeePerGas){const{lastBaseFeePerGas:a}=await i.getFeeData();if(!a)throw new Error("Unable to fetch baseFee for last block.");const s=e.BigNumber.from(a),t=s.mul(e.BigNumber.from(126)).div(e.BigNumber.from(100)).add(e.BigNumber.from(r.maxPriorityFeePerGas));r.maxFeePerGas=h.convertBigNumberish(t)}}catch(e){throw new Error(`Failed to set gas price for OP stack transaction: ${e}.`)}return r},exports.estimateOpStackL1Gas=async function(a,s){if(!a.chainId||a.chainId&&!F(a.chainId))return e.BigNumber.from(0);let t=e.BigNumber.from(0);try{const e=new r.Contract(p,G,s),o=h.toEthersUnsignedTransaction(a),n=i.serialize(o);t=await e.getL1Fee(n)}catch(e){}return t},exports.isOpStack=F;
